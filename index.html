<!DOCTYPE html>
<html lang="en">

<head>


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
        crossorigin="anonymous"></script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P2D Sheet</title>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@2.8.2/dist/alpine.min.js" defer></script>
    <style>

    </style>
</head>

<body>
    <div x-data="runewordsApp()" x-init="fetchRunewords()">
        <ul class="nav nav-tabs mt-2" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="runewords-tab" data-bs-toggle="tab"
                    data-bs-target="#runewords-panel" type="button" role="tab" aria-controls="home-tab-pane"
                    aria-selected="true">
                    Runewords
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="cube-recipes-tab" data-bs-toggle="tab" data-bs-target="#cube-recipes-panel"
                    type="button" role="tab" aria-controls="profile-tab-pane" aria-selected="false">Cube
                    Recipes</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="craftingTab" data-bs-toggle="tab" data-bs-target="#craft-recipes-panel"
                    type="button" role="tab" aria-controls="profile-tab-pane" aria-selected="false"> Crafting</button>
            </li>
        </ul>
        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active mx-2" id="runewords-panel" role="tabpanel" aria-labelledby="home-tab"
                tabindex="0">
                <!-- Filter Form -->
                <div class="filter-form">
                    <h3>Rune words</h3>
                    <form>
                        <div class="row g-2">
                            <div class="col-auto form-floating">
                                <input type="text" x-model="quickSearch" class="form-control" id="quickSearchFL"
                                    placeholder="Quicksearch">
                                <label for="quickSearchFL">Quick Search</label>
                            </div>
                            <div class="col-auto form-floating">
                                <input style="min-width: 100px;" type="number" min="1" max="6" x-model="filters.sockets"
                                    class="form-control" id="searchSockets" placeholder="Sockets">
                                <label for="searchSockets">Sockets</label>
                            </div>
                            <div class="col-auto form-floating">
                                <input type="text" x-model="filters.name" class="form-control" id="searchName"
                                    placeholder="Name">
                                <label for="searchName">Runeword Name</label>
                            </div>
                            <div class="col-auto form-floating">
                                <input type="text" x-model="filters.rune" class="form-control" id="searchRune"
                                    placeholder="Name">
                                <label for="searchRune">Rune</label>
                            </div>
                            <div class="col-auto form-floating">
                                <input type="text" x-model="filters.itemType" class="form-control" id="itemTypeFl"
                                    placeholder="Item Type">
                                <label for="itemTypeFl">ItemType</label>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Runewords Table -->
                <table class="table table-bordered mt-2 table-striped">
                    <thead>
                        <tr>
                            <th @click="sortTable('Name')"
                                :class="sortBy === 'Name' ? (sortAsc ? 'sort-asc' : 'sort-desc') : ''">
                                Name
                            </th>
                            <th @click="sortTable('ItemType')"
                                :class="sortBy === 'ItemType' ? (sortAsc ? 'sort-asc' : 'sort-desc') : ''">
                                Item Type
                            </th>
                            <th @click="sortTable('Sockets')"
                                :class="sortBy === 'Sockets' ? (sortAsc ? 'sort-asc' : 'sort-desc') : ''">
                                Sockets
                            </th>
                            <th @click="sortTable('CharacterLevel')"
                                :class="sortBy === 'CharacterLevel' ? (sortAsc ? 'sort-asc' : 'sort-desc') : ''">
                                Character Level
                            </th>
                            <th>Runes</th>
                            <th>Bonuses</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="runeword in filteredRunewords" :key="runeword.Name">
                            <tr>
                                <td x-text="runeword.Name"></td>
                                <td x-text="runeword.ItemType"></td>
                                <td x-text="runeword.Sockets"></td>
                                <td x-text="runeword.CharacterLevel"></td>
                                <td>
                                    <ul>
                                        <!-- Dynamically render up to 6 runes -->
                                        <template x-for="(rune, index) in runeword.Runes" :key="index">
                                            <li x-text="rune"></li>
                                        </template>
                                    </ul>
                                </td>
                                <td>
                                    <ul>
                                        <template x-for="bonus in runeword.Bonuses" :key="bonus">
                                            <li x-text="bonus"></li>
                                        </template>
                                    </ul>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
            <div class="tab-pane fade" id="cube-recipes-panel" role="tabpanel" aria-labelledby="home-tab" tabindex="0">
                ...
            </div>
        </div>






    </div>


</body>
<script type="text/javascript">
    function runewordsApp() {
        return {
            runewords: [],
            filters: {
                sockets: '',
                name: '',
                rune: '',
                itemType: ''
            },
            quickSearch: '', // New quick search model
            sortBy: '',  // Column to sort by
            sortAsc: true, // Sort direction

            // Compute filtered runewords based on the current filters and quicksearch
            get filteredRunewords() {
                let filtered = this.runewords.filter(runeword => {
                    // Apply filters based on the quick search and specific filters
                    let matchesQuickSearch = this.quickSearch === '' || (
                        runeword.Name.toLowerCase().includes(this.quickSearch.toLowerCase()) ||
                        runeword.ItemType.toLowerCase().includes(this.quickSearch.toLowerCase()) ||
                        runeword.Runes.some(rune => rune.toLowerCase().includes(this.quickSearch.toLowerCase())) ||
                        runeword.Bonuses.some(bonus => bonus.toLowerCase().includes(this.quickSearch.toLowerCase()))
                    );

                    return matchesQuickSearch &&
                        (this.filters.sockets === '' || runeword.Sockets == this.filters.sockets) &&
                        (this.filters.name === '' || runeword.Name.toLowerCase().includes(this.filters.name.toLowerCase())) &&
                        (this.filters.rune === '' ||
                            runeword.Runes.some(rune => rune.toLowerCase().includes(this.filters.rune.toLowerCase()))
                        ) &&
                        (this.filters.itemType === '' || runeword.ItemType.toLowerCase().includes(this.filters.itemType.toLowerCase()));
                });

                // Sort the filtered runewords
                if (this.sortBy) {
                    filtered.sort((a, b) => {
                        let valA = a[this.sortBy];
                        let valB = b[this.sortBy];

                        // Handle sorting by numbers (sockets, character level)
                        if (typeof valA === 'number' && typeof valB === 'number') {
                            return this.sortAsc ? valA - valB : valB - valA;
                        }

                        // Default string sorting
                        return this.sortAsc ? valA.localeCompare(valB) : valB.localeCompare(valA);
                    });
                }

                return filtered;
            },

            // Fetch runewords from an external JSON file
            async fetchRunewords() {
                try {
                    const response = await fetch('RuneWords.json'); // External JSON file path
                    const data = await response.json();
                    this.runewords = data.Runewords.map(runeword => {
                        // Ensure each runeword has a 'Runes' array, filling with empty strings if fewer than 6
                        const runes = [
                            runeword.Rune1,
                            runeword.Rune2,
                            runeword.Rune3,
                            runeword.Rune4 || '',
                            runeword.Rune5 || '',
                            runeword.Rune6 || ''
                        ].filter(rune => rune);  // Remove empty entries
                        return { ...runeword, Runes: runes };
                    });
                } catch (error) {
                    console.error('Error loading the JSON file:', error);
                }
            },

            // Toggle sorting direction and set the column to sort by
            sortTable(column) {
                if (this.sortBy === column) {
                    this.sortAsc = !this.sortAsc; // Toggle sort direction
                } else {
                    this.sortBy = column; // Set the column to sort by
                    this.sortAsc = true;  // Default to ascending
                }
            }
        };
    }
</script>

</html>